<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alojamientos en Mendoza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Clase base para todas las tarjetas */
        .card {
            overflow: visible !important; /* Asegura que el contenido pueda salirse de los límites */
            position: relative; /* Permite que z-index funcione en la tarjeta */
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #loadingMessage {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #555;
        }
        .carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .carousel-images {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-images img {
            width: 100%;
            flex-shrink: 0;
            height: 224px;
            object-fit: cover;
        }
        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            z-index: 10;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
        }
        .carousel-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .carousel-button.prev {
            left: 0.5rem;
        }
        .carousel-button.next {
            right: 0.5rem;
        }

        /* Collapsible content styles */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 1.5rem;
            margin-top: 0.5rem;
        }
        .collapsible-content.expanded {
            max-height: 9999px;
            padding-bottom: 1rem;
        }
        .collapsible-button {
            width: 100%;
            background-color: #f3f4f6;
            color: #4b5563;
            padding: 0.75rem 1.5rem;
            border: none;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border-radius: 0.375rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .collapsible-button:hover {
            background-color: #e5e7eb;
        }
        .collapsible-button i {
            margin-left: 0.5rem;
            transition: transform 0.3s ease-in-out;
        }
        .collapsible-button.active i {
            transform: rotate(180deg);
        }

        /* Dropdown styles */
        .dropdown-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000; /* Elevado para asegurar visibilidad */
            border-radius: 0.375rem;
            overflow: hidden;
            width: 100%;
            left: 0;
            top: 100%;
            transform: translateY(0.25rem);
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
            transition: background-color 0.2s;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown-container.open .dropdown-content {
            display: block;
        }

        /* Eleva la tarjeta activa */
        .card.active-card {
            z-index: 999; /* Asegura que la tarjeta activa esté por encima de sus vecinas */
        }
        #alojamientosContainer {
            align-items: start;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-gradient-to-r from-black to-gray-700 text-[#c2b64f] shadow-lg">
        <div class="container mx-auto px-6 py-8 text-center">
            <h1 class="text-4xl font-bold">Descubre Alojamientos en Mendoza</h1>
            <p class="mt-2 text-lg">Encuentra el lugar perfecto para tu estadía en la tierra del sol y el buen vino.</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div id="alojamientosContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        </div>
        <div id="loadingMessage" style="display: none;">Cargando alojamientos...</div>
        <div id="errorMessage" class="text-red-500 text-center mt-4" style="display: none;"></div>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Alojamientos Mendoza. Todos los derechos reservados.</p>
            <p class="mt-1 text-sm">Diseñado con <span class="text-red-500">&hearts;</span> para tu viaje.</p>
        </div>
    </footer>

    <script>
        const alojamientosContainer = document.getElementById('alojamientosContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');
        const jsonFile = 'alojamientos.json';

        function crearTarjetaAlojamiento(alojamiento) {
            const tieneWhatsAppValido = alojamiento.whatsapp && alojamiento.whatsapp.trim() !== "" && (alojamiento.activo === undefined || alojamiento.activo === true);

            const card = document.createElement('div');
            // === MODIFICACIÓN CLAVE EN JS ===
            // Añadimos la clase 'card' explícitamente para que los selectores CSS funcionen
            card.className = 'card bg-white rounded-lg shadow-md card-hover transition-all duration-300 flex flex-col';

            // Carousel
            const carouselContainer = document.createElement('div');
            carouselContainer.className = 'carousel-container';
            const carouselImages = document.createElement('div');
            carouselImages.className = 'carousel-images';
            let currentImageIndex = 0;
            const imagesToDisplay = alojamiento.imagenes && alojamiento.imagenes.length > 0 ? alojamiento.imagenes : ['https://placehold.co/600x400/CCCCCC/FFFFFF?text=Imagen+No+Disponible'];

            imagesToDisplay.forEach(imgUrl => {
                const img = document.createElement('img');
                img.src = imgUrl;
                img.alt = `Imagen de ${alojamiento.nombre}`;
                img.className = 'w-full h-56 object-cover';
                img.onerror = () => { img.src = 'https://placehold.co/600x400/CCCCCC/FFFFFF?text=Error+Al+Cargar+Imagen'; };
                carouselImages.appendChild(img);
            });
            carouselContainer.appendChild(carouselImages);

            if (imagesToDisplay.length > 1) {
                const prevButton = document.createElement('button');
                prevButton.className = 'carousel-button prev';
                prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevButton.onclick = (e) => {
                    e.stopPropagation();
                    currentImageIndex = (currentImageIndex - 1 + imagesToDisplay.length) % imagesToDisplay.length;
                    carouselImages.style.transform = `translateX(-${currentImageIndex * 100}%)`;
                };
                carouselContainer.appendChild(prevButton);

                const nextButton = document.createElement('button');
                nextButton.className = 'carousel-button next';
                nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextButton.onclick = (e) => {
                    e.stopPropagation();
                    currentImageIndex = (currentImageIndex + 1) % imagesToDisplay.length;
                    carouselImages.style.transform = `translateX(-${currentImageIndex * 100}%)`;
                };
                carouselContainer.appendChild(nextButton);
            }
            card.appendChild(carouselContainer);

            // Content div
            const contentDiv = document.createElement('div');
            contentDiv.className = 'p-6 flex flex-col flex-grow';

            const nombre = document.createElement('h3');
            nombre.className = 'text-2xl font-semibold text-gray-800 mb-2';
            nombre.textContent = alojamiento.nombre;
            contentDiv.appendChild(nombre);

            const descripcion = document.createElement('p');
            descripcion.className = 'text-gray-600 mb-4';
            descripcion.textContent = alojamiento.descripcion;
            contentDiv.appendChild(descripcion);

            // Collapsible details
            if (alojamiento.detallesAdicionales) {
                const collapsibleButton = document.createElement('button');
                collapsibleButton.className = 'collapsible-button';
                collapsibleButton.innerHTML = `Ver más detalles <i class="fas fa-chevron-down"></i>`;
                contentDiv.appendChild(collapsibleButton);

                const collapsibleContent = document.createElement('div');
                collapsibleContent.className = 'collapsible-content';

                if (alojamiento.detallesAdicionales.titulo) {
                    const detallesTitulo = document.createElement('h4');
                    detallesTitulo.className = 'text-lg font-semibold text-gray-700 mb-2 mt-4';
                    detallesTitulo.textContent = alojamiento.detallesAdicionales.titulo;
                    collapsibleContent.appendChild(detallesTitulo);
                }
                if (alojamiento.detallesAdicionales.textoExtenso) {
                    const textoExtenso = document.createElement('p');
                    textoExtenso.className = 'text-gray-600 text-sm mb-2';
                    textoExtenso.textContent = alojamiento.detallesAdicionales.textoExtenso;
                    collapsibleContent.appendChild(textoExtenso);
                }
                if (alojamiento.detallesAdicionales.capacidadMaxima) {
                    const capacidad = document.createElement('p');
                    capacidad.className = 'text-gray-700 text-sm mb-1';
                    capacidad.innerHTML = `<strong>Capacidad:</strong> ${alojamiento.detallesAdicionales.capacidadMaxima}`;
                    collapsibleContent.appendChild(capacidad);
                }
                if (alojamiento.detallesAdicionales.servicios && alojamiento.detallesAdicionales.servicios.length > 0) {
                    const serviciosTitulo = document.createElement('p');
                    serviciosTitulo.className = 'text-gray-700 text-sm font-semibold mt-2 mb-1';
                    serviciosTitulo.textContent = 'Servicios Incluidos:';
                    collapsibleContent.appendChild(serviciosTitulo);
                    const serviciosList = document.createElement('ul');
                    serviciosList.className = 'list-disc list-inside text-gray-600 text-sm mb-2';
                    alojamiento.detallesAdicionales.servicios.forEach(servicio => {
                        const listItem = document.createElement('li');
                        listItem.textContent = servicio;
                        serviciosList.appendChild(listItem);
                    });
                    collapsibleContent.appendChild(serviciosList);
                }
                if (alojamiento.detallesAdicionales.amenities && alojamiento.detallesAdicionales.amenities.length > 0) {
                    const amenitiesTitulo = document.createElement('p');
                    amenitiesTitulo.className = 'text-gray-700 text-sm font-semibold mt-2 mb-1';
                    amenitiesTitulo.textContent = 'Comodidades de la habitación:';
                    collapsibleContent.appendChild(amenitiesTitulo);
                    const amenitiesList = document.createElement('ul');
                    amenitiesList.className = 'list-disc list-inside text-gray-600 text-sm mb-2';
                    alojamiento.detallesAdicionales.amenities.forEach(amenity => {
                        const listItem = document.createElement('li');
                        listItem.textContent = amenity;
                        amenitiesList.appendChild(listItem);
                    });
                    collapsibleContent.appendChild(amenitiesList);
                }

                contentDiv.appendChild(collapsibleContent);

                collapsibleButton.onclick = () => {
                    document.querySelectorAll('.collapsible-content.expanded').forEach(openContent => {
                        if (openContent !== collapsibleContent) {
                            openContent.classList.remove('expanded');
                            const relatedButton = openContent.previousElementSibling;
                            if (relatedButton && relatedButton.classList.contains('collapsible-button')) {
                                relatedButton.classList.remove('active');
                                relatedButton.querySelector('i').classList.remove('fa-chevron-up');
                                relatedButton.querySelector('i').classList.add('fa-chevron-down');
                            }
                        }
                    });

                    collapsibleContent.classList.toggle('expanded');
                    collapsibleButton.classList.toggle('active');
                    const icon = collapsibleButton.querySelector('i');
                    if (collapsibleContent.classList.contains('expanded')) {
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    } else {
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    }
                };
            }

            // Price and location
            const infoDiv = document.createElement('div');
            infoDiv.className = 'flex justify-between items-center mt-auto mb-4';
            const precio = document.createElement('span');
            precio.className = 'text-xl font-bold text-purple-600';
            precio.textContent = alojamiento.precio;
            infoDiv.appendChild(precio);
            const ubicacion = document.createElement('span');
            ubicacion.className = 'text-sm text-gray-500';
            ubicacion.textContent = alojamiento.ubicacion;
            infoDiv.appendChild(ubicacion);
            contentDiv.appendChild(infoDiv);

            // Action buttons (Social media dropdown & WhatsApp)
            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'grid grid-cols-1 sm:grid-cols-2 gap-2';

            const dropdownContainer = document.createElement('div');
            dropdownContainer.className = 'dropdown-container';
            const detallesButton = document.createElement('button');
            detallesButton.className = 'w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 text-center flex items-center justify-center';
            detallesButton.innerHTML = `Redes Sociales <i class="fas fa-caret-down ml-2"></i>`;
            const dropdownContent = document.createElement('div');
            dropdownContent.className = 'dropdown-content';

            let hasSocialMedia = false;
            if (alojamiento.redesSociales) {
                for (const platform in alojamiento.redesSociales) {
                    if (alojamiento.redesSociales.hasOwnProperty(platform) && alojamiento.redesSociales[platform]) {
                        const socialLink = document.createElement('a');
                        socialLink.href = alojamiento.redesSociales[platform];
                        socialLink.target = '_blank';
                        socialLink.rel = 'noopener noreferrer';
                        socialLink.textContent = platform.charAt(0).toUpperCase() + platform.slice(1);
                        dropdownContent.appendChild(socialLink);
                        hasSocialMedia = true;
                    }
                }
            }

            if (hasSocialMedia) {
                dropdownContainer.appendChild(detallesButton);
                dropdownContainer.appendChild(dropdownContent);
                buttonsDiv.appendChild(dropdownContainer);

                detallesButton.onclick = (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('.dropdown-container.open').forEach(openDropdown => {
                        if (openDropdown !== dropdownContainer) {
                            openDropdown.classList.remove('open');
                            // Usamos .closest('.card') para asegurarnos de encontrar la tarjeta padre
                            openDropdown.closest('.card').classList.remove('active-card');
                        }
                    });

                    dropdownContainer.classList.toggle('open');
                    if (dropdownContainer.classList.contains('open')) {
                        card.classList.add('active-card');
                    } else {
                        card.classList.remove('active-card');
                    }
                };
                dropdownContent.addEventListener('click', (e) => { e.stopPropagation(); });
                document.addEventListener('click', (e) => {
                    if (!dropdownContainer.contains(e.target)) {
                        dropdownContainer.classList.remove('open');
                        card.classList.remove('active-card');
                    }
                });
            } else {
                const noSocialMediaButton = document.createElement('button');
                noSocialMediaButton.className = 'w-full bg-gray-300 text-gray-500 font-semibold py-2 px-4 rounded-lg cursor-not-allowed';
                noSocialMediaButton.textContent = 'Redes (No disponibles)';
                noSocialMediaButton.disabled = true;
                buttonsDiv.appendChild(noSocialMediaButton);
            }

            if (tieneWhatsAppValido) {
                const whatsappLink = document.createElement('a');
                whatsappLink.href = `https://wa.me/${alojamiento.whatsapp.replace(/\D/g, '')}`;
                whatsappLink.target = '_blank';
                whatsappLink.rel = 'noopener noreferrer';
                whatsappLink.className = 'w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 text-center';
                whatsappLink.textContent = 'WhatsApp';
                buttonsDiv.appendChild(whatsappLink);
            } else {
                const noWhatsAppButton = document.createElement('button');
                noWhatsAppButton.className = 'w-full bg-gray-300 text-gray-500 font-semibold py-2 px-4 rounded-lg cursor-not-allowed';
                noWhatsAppButton.textContent = 'WhatsApp (No disponible)';
                noWhatsAppButton.disabled = true;
                buttonsDiv.appendChild(noWhatsAppButton);
            }

            contentDiv.appendChild(buttonsDiv);
            card.appendChild(contentDiv);
            return card;
        }

        async function cargarAlojamientos() {
            loadingMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            alojamientosContainer.innerHTML = '';

            try {
                const response = await fetch(jsonFile);
                if (!response.ok) {
                    throw new Error(`Error al cargar el archivo JSON: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();

                if (data && data.alojamientos && data.alojamientos.length > 0) {
                    data.alojamientos.forEach(alojamiento => {
                        const debeMostrar = alojamiento.activo === true || alojamiento.mostrarSiInactivo === true;
                        if (debeMostrar) {
                            const tarjeta = crearTarjetaAlojamiento(alojamiento);
                            if (tarjeta) {
                                alojamientosContainer.appendChild(tarjeta);
                            }
                        }
                    });
                } else {
                    errorMessage.textContent = 'No se encontraron alojamientos para mostrar.';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching o procesando alojamientos:', error);
                errorMessage.textContent = `No se pudieron cargar los alojamientos. Por favor, intenta más tarde. (${error.message})`;
                errorMessage.style.display = 'block';
            } finally {
                loadingMessage.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', cargarAlojamientos);
    </script>
</body>
</html>